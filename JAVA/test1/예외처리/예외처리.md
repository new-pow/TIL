# **예외 / 예외 클래스**

## 오류의 종류

- 에러 Error
    - compile time error : 문법 오류
    - run time error : 문법적으로는 오류가 안뜨나 오류인 것
- 예외 Exception

## 에러 Error

- 하드웨어의 잘못된 동작 또는 고장으로 인한 오류
- 에러가 발생하면 프로그램 종료
- 정상 실행 상태로 돌아갈 수 없음
- **컴파일 에러**
    - 문법에 맞지 않을 경우
    - 컴파일 시 처리 가능
    - 이클립스에서 코드 작성하고 저장하는 순간 컴파일 되면서 바로 오류 확인 가능
- **런타임 에러**
    - 실행 시간 오류 - 프로그램 실행 중에 발생하는 오류
    - 프로그램 강제 종료
    - 잘못된 메모리 접근 오류, 논리 오류, 사용자의 잘못된 입력 등

## 예외 Exception

- 사용자의 잘못된 조작 또는 개발자의 잘못된 코딩으로 인한 오류
- 예외가 발생하면 프로그램이 종료
- 예외 처리를 통해서 정상 실행 상태로 돌아갈 수 있음.
- 오류 중에서 대처 가능한 오류

## 예외의 종류

- 일반 예외 Exception
    - 컴파일 체크
    - 예외 처리 코드가 없으면 컴파일 오류 발생
- 실행 예외 RuntimeException
    - 예외 처리 코드를 생략하더라도 컴파일이 되는 예외
    - 경험에 따라 예외 처리 코드 작성 필요

### 자바에서의 예외 관리

- 자바에서의 예외를 클래스로 관리
- JVM은 프로그램을 실행하는 도중에 예외가 발생하면 해당 예외 클래스 객체 생성하여
- 예외 처리 코드에서 예외 객체를 이용할 수 있도록 함.
- 모든 예외 클래스는 java.lang.Exception 클래스 상속 받음.

# **실행 예외**

## NullPointerException

- 객체 참조가 없는 상태
- null 값을 갖는 참조 변수로 객체 접근 연산자인 도트(.) 사용했을 때 발생

```java
String data = null;
System.out.println(data.equals("자바");
```

- 예제 : NullPointerException.java
    
    

## **ArrayIndexOutOfBoundsException**

- 배열에서 인덱스 범위 초과하여 사용할 경우 발생
- 예제 : ArrayIndexOutOfBoundsExceptionEx**.java**
- 예제 : ArrayIndexOutOfBoundsExceptionEx2.java
    
    main()의 매개변수 args에 매개값 사용
    
    main()의 매개변수 args에 매개값 전달
    
    - 메뉴 Run / Run Configurations..
    - Arguments 탭 / Program Arguments 에서 값 설정

## **NumberFormatException**

- 숫자로 처리에서 발생하는 예외
- NumberFormatExceptionEx.java
    - 숫자 형태의 문자열을 숫자로 타입 변환 가능
    - 문자가 섞인 숫자는 숫자로 타입 변환 불가
    - 웹 문서에서 입력 : 숫자로 입력
    - > 서버로 전송 : 입력된 값은 모두 문자열로 전송
    - 서버에서 받아서 숫자로 사용할 값은 숫자로 타입 변환을 해 줘야지 오류가 없음

## ClassCastException

- 타입 변환이 되지 않을 경우 발생
- 타입 변환 발생
    - 상위 클래스와 하위 클래스 간 발생
    - 구현 클래스와 인터페이스 간에 발생
    - 자동 타입 변환 / 강제 타입 변환
- 강제 타입 변환 시 ClassCastException 예외 발생시키지 않으려면
- 강제 타입 변환 전에 타입 변환이 가능한지 instanceof 연산자로 확인

- 예제 : ClassCastExceptionEx.java

# **예외 처리**

- 예외 발생 시 프로그램 종료되지 않게 하고, 정상 실행을 유지할 수 있도록 처리하는 코드
    - 일반 예외 : 반드시 작성해야 컴파일 가능
    - 실행 예외
        - 컴파일러가 체크해주지 않으며 개발자의 경험에 의해 작성
        - 일부는 이클립스가 주의를 주기 때문에 미리 알 수 있음
- try ~ catch ~ finally 블록을 이용해서 예외 처리 코드 작성

## try ~ catch ~ finally 구문

```java
try {
	예외가 발생할 가능성이 있는 문장
} catch(처리할 예외타입 선언) {
	예외처리 문장
	예외가 발생하지 않으면 이부분은 수행되지 않음
} finally {  // 생략가능
	예외 발생 여부와 상관없이 무조건 실행되는 문장
	(리소스 종료 전에 반납할 때 주로 사용함)
}
```

- 자동 삽입
    - 컴파일러 제시할 경우
        1. 빨간 줄 위에 마우스 대고
        2. Surround try~catch block 선택
    - 직접 삽입할 경우
        - 메뉴 Source - surround with - try/catch block
        - 예외 처리할 문장 모두 드래그해서 선택한 후 (선택 안 하면 선택하라고 메시지 출력)

- try~catch 예외처리 예제 p431 : **TryCatchEx.java**
- 연습문제 : ExceptionEx.java
    - 다음과 같이 예외 처리 프로그램 작성
        - 2개의 정수를 입력 받아서 나누기 수행
        - 나누는 수를 0으로 입력 받는 경우의 에러 발생에 대해
        - 예외
        - 정수1 입력 : 6
        - 정수2 입력 : 2
        - 나누기 결과 : 3

### 다중 catch

- 예외 별로 예외 처리 코드를 다르게 구현
- catch 블록 여러 개 포함
- 주의! 단 하나의 catch블록만 수행
    - try 블록에서 여러 예외가 동시에 발생하지 않고
    - 문장 순서대로 수행하면서 하나의 예외가 발생하면
    - 즉시 실행을 멈추고, 해당 catch 블록으로 이동.

```java
try {
	// 실행문
	//
	//
} catch(ArrayIndexOutOfBoundsException e) {
		// 예외처리 1
} catch(NumberFormatException e) {
		// 예외처리 2
}
```

- 예제 :

### 자바에서 예외 클래스

# **예외 처리 떠넘기기**

## throws

- 메소드에서 처리하지 않은 예외를 호출한 곳으로 떠넘기는 역할
- 메소드 선언부 끝에 추가해서 작성

```java
리턴타입 메소드명(매개변수) throws 예외클래스1, 예외클래스2... {

}
```

- 발생할 수 있는 예외 종류별로 throws 뒤에 나열하는 것이 일반적이지만
- throws Exception만으로 간단히 예외를 떠넘길 수 있음
- throws가 붙어있는 메소드는 반드시 try 블록 내에서 호출되어야 하고
- catch 블록에서 예외를 처리해야 함. (호출한 곳에서 예외 처리)

ex. DAO의 메소드를 호출하는 컨트롤러에게 예외 처리를 떠 넘길 수 있음.

Main(화면 : 입력) → 컨트롤러 → DAO → 데이터베이스

- throws 예제 : TrowsEx.java

# **사용자 정의 예외 / 예외 발생**

## 사용자 정의 예외 클래스 선언

- 자바 표준 API에서 제공하지 않는 예외 처리
- 개발자가 직접 정의해서 처리
- 애플리케이션 서비스와 관련된 예외
    - 예 : 잔고 부족 예외, 계좌 이체 실패 예외 등등

## 사용자 정의 예외 클래스 선언 방법

### 예외 클래스를 상속받는 클래스로 생성

1. 컴파일러가 체크하는 일반 예외로 선언하거나
    1. Exception 상속
2. 컴파일러가 체크하지 않는 실행 예외로 선언
    1. RuntimeException 상속

```java
public class XXXException extends
```

### 예외 발생시키기 : throw

- 호출된 곳에서 발생한 예외를 처리하도록
- 코드에서 예외 발생시키는 방법

```java
// 예외 객체 생성

throw new XXXException()
throw new XXXException("메세지"); // 메세지 필요한 경우
```

```java
public void method() throws XXXException {
	throw new XXXException("메세지");
}
```

- throw : 예외 발생
- throws : 자신을 호출한 곳에서 예를 처리하도록 예외를 떠 넘기는 것

- 사용자 정의 예외와 예외 발생 예제 p445
    - BalanceInsufficientException.java
        - Exception 클래스를 상속
        - 사용자가 만든 예외
    - Account.java
        - getBalance() : 잔고 알려주기
        - deposit() : 예금
        - withdraw() : 출금 (잔고 부족 발생)
            - 예외를 떠 넘기기
            - 여기서 발생하는 예외 : BalancesufficientException
            - 이 메소드를 호출한 곳으로 예외 처리를 떠 넘김
            - 메소드명 뒤에 throws 필요
    - AccountMain.java
        - 업무 수행
        - 출금 처리 시 withdraw()메소드 호출
            - 발생된 예외를 여기서 처리
            - try : withdraw() 메소드 호출
            - catch : 예외 처리

### getMessage()

- 예외 발생 시킬 때 생성자 매개값으로 전달해서 예외 객체 내부에 저장된 메시지 리턴
- 원인 세분화하기 위해 예외 코드 포함
- catch 절에서 활용

```java
throw new XXXException("예외 메시지");
```

```java
} catch (Exception e) {
		String message = e.getMessage(); //예외 객체 e활용하여 호출
}
```

### printStackTrace()

- 예외 발생 코드를 추적한 내용을 모두 콘솔에 출력
- 프로그램 테스트하면서 오류 찾을 때 유용하게 활용